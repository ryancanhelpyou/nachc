!function(a,b,c){"use strict";function d(a,c){this.element=a,this.$element=b(a),this.options=b.extend(!0,{},f,c),this.prefix=c.prefix,this.settings=c.settings,this.accounts=c.accounts,this._defaults=f,this._name=e,this.init()}var e="gfRoutingSetting",f={prefix:"",allowMultiple:!0,imagesURL:"",operatorStrings:{is:"is",isnot:"isNot",">":"greaterThan","<":"lessThan",contains:"contains",starts_with:"startsWith",ends_with:"endsWith"},items:[{target:"",fieldId:"0",operator:"is",value:"",type:""}],callbacks:{addNewTarget:function(){},header:function(){return'<thead><tr><th>Assign To</th><th colspan="3">Condition</th></tr></thead>'}}};d.prototype={init:function(){var a,c,d=this;c=this.getHeaderMarkup(),a='<table class="gform-routings">{0}<tbody class="repeater">{1}</tbody></table>'.format(c,this.getNewRoutingRow());var e=b(a);e.find(".repeater").repeater({limit:0,items:this.options.items,addButtonMarkup:'<img class="gform-add" src="{0}/images/add.png" />'.format(gf_vars.baseUrl),removeButtonMarkup:'<img class="gform-remove" src="{0}/images/remove.png" />'.format(gf_vars.baseUrl),callbacks:{save:function(a,c){b("#"+d.options.fieldId).val(b.toJSON(c))},beforeAdd:function(a,b,c){var e=b.find(".gform-routing-target");e.val(c.target);var f=b.find(".gform-routing-field").first();f.value=c.fieldId,d.changeField(f);var g=b.find(".gform-routing-operator").first();g.value=c.operator,d.changeOperator(g);var h=b.find(".gform-routing-value");h.val(c.value)}}}).on("change",".gform-routing-field",function(a){d.changeField(this)}).on("click",".gform-no-filters",function(a){var c=b(this),e=c.find(".gform-routing");0==e.length&&d.addNewRouting(this),c.remove(),a.preventDefault()}).on("change",".gform-routing-operator",function(){d.changeOperator(this)}),this.$element.append(e)},getHeaderMarkup:function(){var a=this.options.callbacks.header(this,"");return a},getNewRoutingRow:function(){var a=[];return a.push("<td>{0}</td>".format(this.getRoutingTarget())),a.push("<td>{0}</td>".format(this.getRoutingFields())),a.push("<td>{0}</td>".format(this.getRoutingOperators(this.options.settings[0]))),a.push("<td>{0}</td>".format(this.getRoutingValues())),a.push("<td>{buttons}</td>"),'<tr class="gform-routing-row">{0}</tr>'.format(a.join(""))},getRoutingTarget:function(){var a='<input type="text" class="gform-routing-target target_{i}">';return a=this.options.callbacks.addNewTarget(this,a)},getRoutingFields:function(){var a,b,c,d,e,f,g,h,i=[],j=this.settings;for(i.push('<select class="gform-routing-field fieldId_{i}" >'),a=0;a<j.length;a++)if(c=j[a].key,j[a].group){for(f=j[a].text,h=j[a].filters.length,g=[],b=0;h>b;b++)e=j[a].filters[b].text,d=j[a].filters[b].key,g.push('<option value="{0}">{1}</option>'.format(d,e));i.push('<optgroup label="{0}">{1}</optgroup>'.format(f,g.join("")))}else e=j[a].text,i.push('<option value="{0}">{1}</option>'.format(c,e));return i.push("</select>"),i.push('<input type="hidden" class="gform-filter-type" name="type_{i}" value="" >'),i.join("")},changeOperator:function(a){var c=b(a),d=c.closest("tr").find(".repeater-buttons"),e=d.find(".add-item ").data("index"),f=c.closest("tr").find(".gform-routing-field"),g=this.getFilter(f.value);g&&c.closest("tr").find(".gform-routing-value").replaceWith(this.getRoutingValues(g,a.value,e))},changeField:function(a){var c=this.getFilter(a.value);if(c){var d=b(a),e=d.closest("tr").find(".repeater-buttons"),f=e.find(".add-item ").data("index");d.closest("tr").find(".gform-routing-value").replaceWith(this.getRoutingValues(c,null,f)),d.closest("tr").find(".gform-filter-type").val(c.type).change();var g=b(this.getRoutingOperators(c,f));d.closest("tr").find(".gform-routing-operator").replaceWith(g),d.closest("tr").find(".gform-routing-operator").change()}},getRoutingOperators:function(a,b){"undefined"!=typeof b&&null!==b||(b="{i}");var c,d,e=this.options.operatorStrings,f='<select class="gform-routing-operator operator_{0}">'.format(b);if(a)for(c=0;c<a.operators.length;c++)d=a.operators[c],f+='<option value="{0}">{1}</option>'.format(d,gf_vars[e[d]]);return f+="</select>"},getRoutingValues:function(a,b,c){var d,e,f,g,h="";if("undefined"!=typeof c&&null!==c||(c="{i}"),a&&a.values&&"contains"!=b){for(d=0;d<a.values.length;d++)e=a.values[d].value,f=a.values[d].text,h+='<option value="{0}">{1}</option>'.format(e,f);g='<select class="gform-routing-value value_{0}">{1}</select>'.format(c,h)}else g='<input type="text" value="" class="gform-routing-value value_{0}" />'.format(c);return g},getFilter:function(a){var b=this.settings;if(a)for(var c=0;c<b.length;c++){if(a==b[c].key)return b[c];if(b[c].group)for(var d=0;d<b[c].filters.length;d++)if(a==b[c].filters[d].key)return b[c].filters[d]}},selected:function(a,b){return a==b?'selected="selected"':""}},b.fn[e]=function(a){return this.each(function(){b.data(this,"plugin_"+e)||b.data(this,"plugin_"+e,new d(this,a))})},String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}}(window.GFRoutingSetting=window.GFRoutingSetting||{},jQuery);